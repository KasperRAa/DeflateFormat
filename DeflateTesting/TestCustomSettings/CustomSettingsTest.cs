using DeflateFormat;
using Newtonsoft.Json.Linq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace DeflateTesting.TestCustomSettings
{
    [TestClass]
    public class CustomSettingsTest
    {
        private string GetText()
        {
            DirectoryInfo? directoryInfo = new DirectoryInfo(Directory.GetCurrentDirectory());
            while (directoryInfo != null && directoryInfo.Name != "DeflateTesting") directoryInfo = directoryInfo.Parent;
            if (directoryInfo == null) throw new NullReferenceException();
            return File.ReadAllText(path: $"{directoryInfo.FullName}\\TestCustomSettings\\DeflateOriginalDocumentation.txt");
        }

        [TestMethod]
        #region Test Settings
        [DataRow(CompressionMethod.Optimal, 3, 1, 1)]
        [DataRow(CompressionMethod.Optimal, 3, 1, 32768)]
        [DataRow(CompressionMethod.Optimal, 3, 1, null)]
        [DataRow(CompressionMethod.Optimal, 3, 16384, 1)]
        [DataRow(CompressionMethod.Optimal, 3, 16384, 32768)]
        [DataRow(CompressionMethod.Optimal, 3, 16384, null)]
        [DataRow(CompressionMethod.Optimal, 3, 32768, 1)]
        [DataRow(CompressionMethod.Optimal, 3, 32768, 32768)]
        [DataRow(CompressionMethod.Optimal, 3, 32768, null)]
        [DataRow(CompressionMethod.Optimal, 130, 1, 1)]
        [DataRow(CompressionMethod.Optimal, 130, 1, 32768)]
        [DataRow(CompressionMethod.Optimal, 130, 1, null)]
        [DataRow(CompressionMethod.Optimal, 130, 16384, 1)]
        [DataRow(CompressionMethod.Optimal, 130, 16384, 32768)]
        [DataRow(CompressionMethod.Optimal, 130, 16384, null)]
        [DataRow(CompressionMethod.Optimal, 130, 32768, 1)]
        [DataRow(CompressionMethod.Optimal, 130, 32768, 32768)]
        [DataRow(CompressionMethod.Optimal, 130, 32768, null)]
        [DataRow(CompressionMethod.Optimal, 258, 1, 1)]
        [DataRow(CompressionMethod.Optimal, 258, 1, 32768)]
        [DataRow(CompressionMethod.Optimal, 258, 1, null)]
        [DataRow(CompressionMethod.Optimal, 258, 16384, 1)]
        [DataRow(CompressionMethod.Optimal, 258, 16384, 32768)]
        [DataRow(CompressionMethod.Optimal, 258, 16384, null)]
        [DataRow(CompressionMethod.Optimal, 258, 32768, 1)]
        [DataRow(CompressionMethod.Optimal, 258, 32768, 32768)]
        [DataRow(CompressionMethod.Optimal, 258, 32768, null)]
        [DataRow(CompressionMethod.Dynamic, 3, 1, 1)]
        [DataRow(CompressionMethod.Dynamic, 3, 1, 32768)]
        [DataRow(CompressionMethod.Dynamic, 3, 1, null)]
        [DataRow(CompressionMethod.Dynamic, 3, 16384, 1)]
        [DataRow(CompressionMethod.Dynamic, 3, 16384, 32768)]
        [DataRow(CompressionMethod.Dynamic, 3, 16384, null)]
        [DataRow(CompressionMethod.Dynamic, 3, 32768, 1)]
        [DataRow(CompressionMethod.Dynamic, 3, 32768, 32768)]
        [DataRow(CompressionMethod.Dynamic, 3, 32768, null)]
        [DataRow(CompressionMethod.Dynamic, 130, 1, 1)]
        [DataRow(CompressionMethod.Dynamic, 130, 1, 32768)]
        [DataRow(CompressionMethod.Dynamic, 130, 1, null)]
        [DataRow(CompressionMethod.Dynamic, 130, 16384, 1)]
        [DataRow(CompressionMethod.Dynamic, 130, 16384, 32768)]
        [DataRow(CompressionMethod.Dynamic, 130, 16384, null)]
        [DataRow(CompressionMethod.Dynamic, 130, 32768, 1)]
        [DataRow(CompressionMethod.Dynamic, 130, 32768, 32768)]
        [DataRow(CompressionMethod.Dynamic, 130, 32768, null)]
        [DataRow(CompressionMethod.Dynamic, 258, 1, 1)]
        [DataRow(CompressionMethod.Dynamic, 258, 1, 32768)]
        [DataRow(CompressionMethod.Dynamic, 258, 1, null)]
        [DataRow(CompressionMethod.Dynamic, 258, 16384, 1)]
        [DataRow(CompressionMethod.Dynamic, 258, 16384, 32768)]
        [DataRow(CompressionMethod.Dynamic, 258, 16384, null)]
        [DataRow(CompressionMethod.Dynamic, 258, 32768, 1)]
        [DataRow(CompressionMethod.Dynamic, 258, 32768, 32768)]
        [DataRow(CompressionMethod.Dynamic, 258, 32768, null)]
        [DataRow(CompressionMethod.Static, 3, 1, 1)]
        [DataRow(CompressionMethod.Static, 3, 1, 32768)]
        [DataRow(CompressionMethod.Static, 3, 1, null)]
        [DataRow(CompressionMethod.Static, 3, 16384, 1)]
        [DataRow(CompressionMethod.Static, 3, 16384, 32768)]
        [DataRow(CompressionMethod.Static, 3, 16384, null)]
        [DataRow(CompressionMethod.Static, 3, 32768, 1)]
        [DataRow(CompressionMethod.Static, 3, 32768, 32768)]
        [DataRow(CompressionMethod.Static, 3, 32768, null)]
        [DataRow(CompressionMethod.Static, 130, 1, 1)]
        [DataRow(CompressionMethod.Static, 130, 1, 32768)]
        [DataRow(CompressionMethod.Static, 130, 1, null)]
        [DataRow(CompressionMethod.Static, 130, 16384, 1)]
        [DataRow(CompressionMethod.Static, 130, 16384, 32768)]
        [DataRow(CompressionMethod.Static, 130, 16384, null)]
        [DataRow(CompressionMethod.Static, 130, 32768, 1)]
        [DataRow(CompressionMethod.Static, 130, 32768, 32768)]
        [DataRow(CompressionMethod.Static, 130, 32768, null)]
        [DataRow(CompressionMethod.Static, 258, 1, 1)]
        [DataRow(CompressionMethod.Static, 258, 1, 32768)]
        [DataRow(CompressionMethod.Static, 258, 1, null)]
        [DataRow(CompressionMethod.Static, 258, 16384, 1)]
        [DataRow(CompressionMethod.Static, 258, 16384, 32768)]
        [DataRow(CompressionMethod.Static, 258, 16384, null)]
        [DataRow(CompressionMethod.Static, 258, 32768, 1)]
        [DataRow(CompressionMethod.Static, 258, 32768, 32768)]
        [DataRow(CompressionMethod.Static, 258, 32768, null)]
        [DataRow(CompressionMethod.Raw, 3, 1, 1)]
        [DataRow(CompressionMethod.Raw, 3, 1, 32768)]
        [DataRow(CompressionMethod.Raw, 3, 1, null)]
        [DataRow(CompressionMethod.Raw, 3, 16384, 1)]
        [DataRow(CompressionMethod.Raw, 3, 16384, 32768)]
        [DataRow(CompressionMethod.Raw, 3, 16384, null)]
        [DataRow(CompressionMethod.Raw, 3, 32768, 1)]
        [DataRow(CompressionMethod.Raw, 3, 32768, 32768)]
        [DataRow(CompressionMethod.Raw, 3, 32768, null)]
        [DataRow(CompressionMethod.Raw, 130, 1, 1)]
        [DataRow(CompressionMethod.Raw, 130, 1, 32768)]
        [DataRow(CompressionMethod.Raw, 130, 1, null)]
        [DataRow(CompressionMethod.Raw, 130, 16384, 1)]
        [DataRow(CompressionMethod.Raw, 130, 16384, 32768)]
        [DataRow(CompressionMethod.Raw, 130, 16384, null)]
        [DataRow(CompressionMethod.Raw, 130, 32768, 1)]
        [DataRow(CompressionMethod.Raw, 130, 32768, 32768)]
        [DataRow(CompressionMethod.Raw, 130, 32768, null)]
        [DataRow(CompressionMethod.Raw, 258, 1, 1)]
        [DataRow(CompressionMethod.Raw, 258, 1, 32768)]
        [DataRow(CompressionMethod.Raw, 258, 1, null)]
        [DataRow(CompressionMethod.Raw, 258, 16384, 1)]
        [DataRow(CompressionMethod.Raw, 258, 16384, 32768)]
        [DataRow(CompressionMethod.Raw, 258, 16384, null)]
        [DataRow(CompressionMethod.Raw, 258, 32768, 1)]
        [DataRow(CompressionMethod.Raw, 258, 32768, 32768)]
        [DataRow(CompressionMethod.Raw, 258, 32768, null)]
        #endregion
        public void TestCompression(CompressionMethod method, int maxLength, int maxDistance, int? maxBlockLength)
        {
            var format = new Deflate(method, maxLength, maxDistance, maxBlockLength);
            string str = GetText();
            byte[] s_messageBytes = Encoding.UTF8.GetBytes(str);
            byte[] compressedBytes = format.Compress(s_messageBytes);
            byte[] bytes = InbuiltDeflate.Decompress(compressedBytes, bufferSize: 65536);
            Assert.AreEqual(str, Encoding.UTF8.GetString(bytes));
        }
        [TestMethod]
        #region Test Settings
        [DataRow(CompressionMethod.Optimal, 3, 1, 1)]
        [DataRow(CompressionMethod.Optimal, 3, 1, 32768)]
        [DataRow(CompressionMethod.Optimal, 3, 1, null)]
        [DataRow(CompressionMethod.Optimal, 3, 16384, 1)]
        [DataRow(CompressionMethod.Optimal, 3, 16384, 32768)]
        [DataRow(CompressionMethod.Optimal, 3, 16384, null)]
        [DataRow(CompressionMethod.Optimal, 3, 32768, 1)]
        [DataRow(CompressionMethod.Optimal, 3, 32768, 32768)]
        [DataRow(CompressionMethod.Optimal, 3, 32768, null)]
        [DataRow(CompressionMethod.Optimal, 130, 1, 1)]
        [DataRow(CompressionMethod.Optimal, 130, 1, 32768)]
        [DataRow(CompressionMethod.Optimal, 130, 1, null)]
        [DataRow(CompressionMethod.Optimal, 130, 16384, 1)]
        [DataRow(CompressionMethod.Optimal, 130, 16384, 32768)]
        [DataRow(CompressionMethod.Optimal, 130, 16384, null)]
        [DataRow(CompressionMethod.Optimal, 130, 32768, 1)]
        [DataRow(CompressionMethod.Optimal, 130, 32768, 32768)]
        [DataRow(CompressionMethod.Optimal, 130, 32768, null)]
        [DataRow(CompressionMethod.Optimal, 258, 1, 1)]
        [DataRow(CompressionMethod.Optimal, 258, 1, 32768)]
        [DataRow(CompressionMethod.Optimal, 258, 1, null)]
        [DataRow(CompressionMethod.Optimal, 258, 16384, 1)]
        [DataRow(CompressionMethod.Optimal, 258, 16384, 32768)]
        [DataRow(CompressionMethod.Optimal, 258, 16384, null)]
        [DataRow(CompressionMethod.Optimal, 258, 32768, 1)]
        [DataRow(CompressionMethod.Optimal, 258, 32768, 32768)]
        [DataRow(CompressionMethod.Optimal, 258, 32768, null)]
        [DataRow(CompressionMethod.Dynamic, 3, 1, 1)]
        [DataRow(CompressionMethod.Dynamic, 3, 1, 32768)]
        [DataRow(CompressionMethod.Dynamic, 3, 1, null)]
        [DataRow(CompressionMethod.Dynamic, 3, 16384, 1)]
        [DataRow(CompressionMethod.Dynamic, 3, 16384, 32768)]
        [DataRow(CompressionMethod.Dynamic, 3, 16384, null)]
        [DataRow(CompressionMethod.Dynamic, 3, 32768, 1)]
        [DataRow(CompressionMethod.Dynamic, 3, 32768, 32768)]
        [DataRow(CompressionMethod.Dynamic, 3, 32768, null)]
        [DataRow(CompressionMethod.Dynamic, 130, 1, 1)]
        [DataRow(CompressionMethod.Dynamic, 130, 1, 32768)]
        [DataRow(CompressionMethod.Dynamic, 130, 1, null)]
        [DataRow(CompressionMethod.Dynamic, 130, 16384, 1)]
        [DataRow(CompressionMethod.Dynamic, 130, 16384, 32768)]
        [DataRow(CompressionMethod.Dynamic, 130, 16384, null)]
        [DataRow(CompressionMethod.Dynamic, 130, 32768, 1)]
        [DataRow(CompressionMethod.Dynamic, 130, 32768, 32768)]
        [DataRow(CompressionMethod.Dynamic, 130, 32768, null)]
        [DataRow(CompressionMethod.Dynamic, 258, 1, 1)]
        [DataRow(CompressionMethod.Dynamic, 258, 1, 32768)]
        [DataRow(CompressionMethod.Dynamic, 258, 1, null)]
        [DataRow(CompressionMethod.Dynamic, 258, 16384, 1)]
        [DataRow(CompressionMethod.Dynamic, 258, 16384, 32768)]
        [DataRow(CompressionMethod.Dynamic, 258, 16384, null)]
        [DataRow(CompressionMethod.Dynamic, 258, 32768, 1)]
        [DataRow(CompressionMethod.Dynamic, 258, 32768, 32768)]
        [DataRow(CompressionMethod.Dynamic, 258, 32768, null)]
        [DataRow(CompressionMethod.Static, 3, 1, 1)]
        [DataRow(CompressionMethod.Static, 3, 1, 32768)]
        [DataRow(CompressionMethod.Static, 3, 1, null)]
        [DataRow(CompressionMethod.Static, 3, 16384, 1)]
        [DataRow(CompressionMethod.Static, 3, 16384, 32768)]
        [DataRow(CompressionMethod.Static, 3, 16384, null)]
        [DataRow(CompressionMethod.Static, 3, 32768, 1)]
        [DataRow(CompressionMethod.Static, 3, 32768, 32768)]
        [DataRow(CompressionMethod.Static, 3, 32768, null)]
        [DataRow(CompressionMethod.Static, 130, 1, 1)]
        [DataRow(CompressionMethod.Static, 130, 1, 32768)]
        [DataRow(CompressionMethod.Static, 130, 1, null)]
        [DataRow(CompressionMethod.Static, 130, 16384, 1)]
        [DataRow(CompressionMethod.Static, 130, 16384, 32768)]
        [DataRow(CompressionMethod.Static, 130, 16384, null)]
        [DataRow(CompressionMethod.Static, 130, 32768, 1)]
        [DataRow(CompressionMethod.Static, 130, 32768, 32768)]
        [DataRow(CompressionMethod.Static, 130, 32768, null)]
        [DataRow(CompressionMethod.Static, 258, 1, 1)]
        [DataRow(CompressionMethod.Static, 258, 1, 32768)]
        [DataRow(CompressionMethod.Static, 258, 1, null)]
        [DataRow(CompressionMethod.Static, 258, 16384, 1)]
        [DataRow(CompressionMethod.Static, 258, 16384, 32768)]
        [DataRow(CompressionMethod.Static, 258, 16384, null)]
        [DataRow(CompressionMethod.Static, 258, 32768, 1)]
        [DataRow(CompressionMethod.Static, 258, 32768, 32768)]
        [DataRow(CompressionMethod.Static, 258, 32768, null)]
        [DataRow(CompressionMethod.Raw, 3, 1, 1)]
        [DataRow(CompressionMethod.Raw, 3, 1, 32768)]
        [DataRow(CompressionMethod.Raw, 3, 1, null)]
        [DataRow(CompressionMethod.Raw, 3, 16384, 1)]
        [DataRow(CompressionMethod.Raw, 3, 16384, 32768)]
        [DataRow(CompressionMethod.Raw, 3, 16384, null)]
        [DataRow(CompressionMethod.Raw, 3, 32768, 1)]
        [DataRow(CompressionMethod.Raw, 3, 32768, 32768)]
        [DataRow(CompressionMethod.Raw, 3, 32768, null)]
        [DataRow(CompressionMethod.Raw, 130, 1, 1)]
        [DataRow(CompressionMethod.Raw, 130, 1, 32768)]
        [DataRow(CompressionMethod.Raw, 130, 1, null)]
        [DataRow(CompressionMethod.Raw, 130, 16384, 1)]
        [DataRow(CompressionMethod.Raw, 130, 16384, 32768)]
        [DataRow(CompressionMethod.Raw, 130, 16384, null)]
        [DataRow(CompressionMethod.Raw, 130, 32768, 1)]
        [DataRow(CompressionMethod.Raw, 130, 32768, 32768)]
        [DataRow(CompressionMethod.Raw, 130, 32768, null)]
        [DataRow(CompressionMethod.Raw, 258, 1, 1)]
        [DataRow(CompressionMethod.Raw, 258, 1, 32768)]
        [DataRow(CompressionMethod.Raw, 258, 1, null)]
        [DataRow(CompressionMethod.Raw, 258, 16384, 1)]
        [DataRow(CompressionMethod.Raw, 258, 16384, 32768)]
        [DataRow(CompressionMethod.Raw, 258, 16384, null)]
        [DataRow(CompressionMethod.Raw, 258, 32768, 1)]
        [DataRow(CompressionMethod.Raw, 258, 32768, 32768)]
        [DataRow(CompressionMethod.Raw, 258, 32768, null)]
        #endregion
        public void TestInternalConsistency(CompressionMethod method, int maxLength, int maxDistance, int? maxBlockLength)
        {
            var format = new Deflate(method, maxLength, maxDistance, maxBlockLength);
            string str = GetText();
            byte[] s_messageBytes = Encoding.UTF8.GetBytes(str);
            byte[] compressedBytes = format.Compress(s_messageBytes);
            byte[] bytes = format.Decompress(compressedBytes);
            Assert.AreEqual(str, Encoding.UTF8.GetString(bytes));
        }
    }
}
